

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data Transformations &mdash; Altair 1.3.0.dev0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/altair-plot.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/altair-gallery.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Altair 1.3.0.dev0 documentation" href="../index.html"/>
        <link rel="up" title="Narrative Documentation" href="index.html"/>
        <link rel="next" title="Configuring Visualizations" href="config.html"/>
        <link rel="prev" title="Marks" href="marks.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Altair
          

          
          </a>

          
            
            
              <div class="version">
                1.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Narrative Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="data.html">Defining Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="encoding.html">Encodings</a></li>
<li class="toctree-l2"><a class="reference internal" href="marks.html">Marks</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Data Transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuring Visualizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="displaying.html">Displaying and Saving Visualizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html">Altair Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">Peformance Considerations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../API.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recipes.html">Plot Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Altair</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Narrative Documentation</a> &raquo;</li>
        
      <li>Data Transformations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/documentation/transform.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-transformations">
<span id="id1"></span><h1>Data Transformations<a class="headerlink" href="#data-transformations" title="Permalink to this headline">¶</a></h1>
<p>Altair provides a data transformation API that allows both <em>filtering</em> and
<em>transformation</em> of values within the plot renderer. Within Vega-Lite, filter
and transforms operations are specified in terms of <em>javascript strings</em> which
make use of Vega’s
<a class="reference external" href="https://github.com/vega/vega/wiki/Expressions">Expression Documentation</a>.
Altair provides a Python-style interface to generate these expressions without
having to create the strings manually; this can be done either via a direct
functional expression interface, or via a Pandas-like dataframe interface.
We will see examples of both of these below.</p>
<p>For example, consider this visualization of the historical US population,
split by age and gender:</p>
<div class="highlight-python" id="transform-rst-altair-source-0"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>

<span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;https://vega.github.io/vega-datasets/data/population.json&#39;</span>
<span class="n">pink_blue</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="s2">&quot;pink&quot;</span><span class="p">])</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;sex:N&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">pink_blue</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-0">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
    vg.embed("#transform-rst-altair-plot-0", "transform-rst-altair-plot-0.vl.json", function(error, result) {});
  });
</script>
</div><p>This visualization shows that on average over the course of history, the
younger population has far outnumbered the older population.</p>
<ol class="arabic simple">
<li>We might wish to zero-in on a particular year, rather than taking a
mean over all years.</li>
<li>The “1” and “2” labels for gender are not all that informative; we should
probably be change them to “Male” and “Female” for clarity.</li>
</ol>
<p>We could certainly accomplish this by downloading the dataset, manipulating it
in, say, pandas, and building a chart using the result, but it would be nice to
do this within the Altair spec itself so that we can use the original data
source.</p>
<p>Vega-Lite allows for this via a <code class="docutils literal"><span class="pre">transform</span></code> field within the plot specification,
and Atltair provides a Pandas-style interface by which these transform fields
can be specified.</p>
<p>To demonstrate this, let’s remake the plot using this interface to filter
the data by year, and to create a new column which maps the <em>1/2</em> labels
to “Male”/”Female”:</p>
<div class="highlight-python" id="transform-rst-altair-source-1"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">altair</span> <span class="kn">import</span> <span class="n">expr</span>

<span class="n">pink_blue</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pink&quot;</span><span class="p">,</span> <span class="s2">&quot;lightblue&quot;</span><span class="p">])</span>

<span class="c1"># this does not actually download data;</span>
<span class="c1"># just puts a dataframe-like interface around the URL reference</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="s1">&#39;https://vega.github.io/vega-datasets/data/population.json&#39;</span><span class="p">)</span>

<span class="c1"># Add a new column to the data</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Male&quot;</span><span class="p">,</span> <span class="s2">&quot;Female&quot;</span><span class="p">)</span>

<span class="c1"># Create a filtered version of the data</span>
<span class="n">data2000</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">]</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data2000</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;gender:N&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">pink_blue</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-1">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
    vg.embed("#transform-rst-altair-plot-1", "transform-rst-altair-plot-1.vl.json", function(error, result) {});
  });
</script>
</div><p>Creating and manipulating the data this way generates appropriate code that
is stored in the spec and then evaluated at the time the plot is generated.
We can see this by printing the resulting specification:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">altair</span> <span class="k">import</span> <span class="n">expr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="s1">&#39;data.json&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Male&quot;</span><span class="p">,</span> <span class="s2">&quot;Female&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data2000</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data2000</span><span class="p">)</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="go">{</span>
<span class="go">  &quot;data&quot;: {</span>
<span class="go">    &quot;url&quot;: &quot;data.json&quot;</span>
<span class="go">  },</span>
<span class="go">  &quot;transform&quot;: {</span>
<span class="go">    &quot;calculate&quot;: [</span>
<span class="go">      {</span>
<span class="go">        &quot;expr&quot;: &quot;if((datum.sex==1),&#39;Male&#39;,&#39;Female&#39;)&quot;,</span>
<span class="go">        &quot;field&quot;: &quot;gender&quot;</span>
<span class="go">      }</span>
<span class="go">    ],</span>
<span class="go">    &quot;filter&quot;: &quot;(datum.year==2000)&quot;</span>
<span class="go">  }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Notice that in the resulting specification the <code class="docutils literal"><span class="pre">data</span></code> field contains only the
URL, and the additional information has been encoded within a <code class="docutils literal"><span class="pre">transform</span></code>
field using the
<a class="reference external" href="https://github.com/vega/vega/wiki/Expressions">Expression Interface</a> provided
by the Vega package.</p>
<p>If you would prefer to add these field manually rather than using the <code class="xref py py-class docutils literal"><span class="pre">expr.DataFrame</span></code>
interface, the <a class="reference internal" href="../API.html#altair.Chart.transform_data" title="altair.Chart.transform_data"><code class="xref py py-meth docutils literal"><span class="pre">transform_data()</span></code></a> method and related <a class="reference internal" href="../API.html#altair.Transform" title="altair.Transform"><code class="xref py py-class docutils literal"><span class="pre">Transform</span></code></a>
class gives you functional access to these attributes using the <code class="xref py py-mod docutils literal"><span class="pre">vega.expr</span></code> syntax:</p>
<div class="highlight-python" id="transform-rst-altair-source-3"><span id="altair-plot-2"></span><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;https://vega.github.io/vega-datasets/data/population.json&#39;</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;gender:N&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">pink_blue</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_data</span><span class="p">(</span>
    <span class="n">calculate</span><span class="o">=</span><span class="p">[</span><span class="n">alt</span><span class="o">.</span><span class="n">Formula</span><span class="p">(</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Male&#39;</span><span class="p">,</span><span class="s1">&#39;Female&#39;</span><span class="p">))],</span>
    <span class="nb">filter</span><span class="o">=</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-3">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
    vg.embed("#transform-rst-altair-plot-3", "transform-rst-altair-plot-3.vl.json", function(error, result) {});
  });
</script>
</div><p>Or if you really like to do things by hand, the raw javascript strings can be
passed instead:</p>
<div class="highlight-python" id="transform-rst-altair-source-5"><span id="altair-plot-4"></span><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;gender:N&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">pink_blue</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_data</span><span class="p">(</span>
    <span class="n">calculate</span><span class="o">=</span><span class="p">[</span><span class="n">alt</span><span class="o">.</span><span class="n">Formula</span><span class="p">(</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;if(datum.sex == 1, &quot;M&quot;, &quot;F&quot;)&#39;</span><span class="p">)],</span>
    <span class="nb">filter</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;datum.year == 2000&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-5">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
    vg.embed("#transform-rst-altair-plot-5", "transform-rst-altair-plot-5.vl.json", function(error, result) {});
  });
</script>
</div><p>While in all these cases the data manipulation could be done as a preprocessing
step, embedding the processed data directly in the URL, this sort of simple
manipulation of an existing data source can lead to much more compact and efficient
plot specifications.</p>
<p>The <a class="reference internal" href="../gallery/bar_grouped.html#gallery-bar-grouped"><span class="std std-ref">Grouped Bar Chart</span></a> example shows a more refined view of this
same dataset using some of these techniques.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="config.html" class="btn btn-neutral float-right" title="Configuring Visualizations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="marks.html" class="btn btn-neutral" title="Marks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Brian Granger and Jake VanderPlas.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3.0.dev0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
      <script type="text/javascript" src="https://vega.github.io/vega/releases/v2.6.5/vega.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vega-lite/1.2.1/vega-lite.min.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vega-embed/2.2.0/vega-embed.min.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>